<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/main.css">
  <title>Page Title</title>


</head>


<!-- send to temp -->


<body>
<div>po ocenie slowa DB sie updateuje ale lokalne arraz sie nie updatuje i moga powstawac dyiwne problemy </div>


<div id="row1">
  <button id="stats">statistics </button>
  <button id="twist"> Twist </button>
  <a href="add_new.html">Add New Word</a>
</div>

<div id="row2">
  <button id="sort_best">Best first</button>
  <button id="sort_worst">Worst first</button>
  <button id="sort_random">Random</button>
  <button id="sort_newest">Newest</button>
  <button id="sort_oldest">Oldest</button>  
  <button id="sort_alphabet">Alphabetically</button>

</div>

<div id="row3">
  Sorry, the connection to the database was not succesfull.  
</div>



<div id="modal_box">
  <div id="modal_content">
    Do you want to delete this word ?<br><br>
    <button id="yes_delete"> YES </button><button id="no_delete">NO</button>
  </div>
</div>

<div id="modal_update">
  <button id="closeUpdate">&#x2715; </button>

  <div id="update_content">
    <form id="updateForm" action="db/update.php">
      <label for="">Word:</label>
      <input type="text" name="word" value="x">
      <label for="">Translation:</label>
      <input type="text" name="translatio">
      <input type="hidden" id="updateId" name="updateId">
      <input type="button" value="Send Update" id="sendUpdate">
    </form> 
  </div>
</div>


<div id="stats_modal">
  <button id="closeStats">&#x2715; </button>
  <div id="stats_content">  </div>
</div>




<img src="" alt="">






<script>

  


// 2. Disply transletion and ratting button after pressing word  
function display(ev){
id = ev.value;
let check_if_active = ev.parentNode.parentNode.children[1].innerText; // this gets a text from second column

if(check_if_active.length==0){ 
for(let x in tabe_db){
  if(tabe_db[x].id==id){
    tabe_iter = x; 
  }
}

  let showword = tabe_db[tabe_iter].transl;
  let score = tabe_db[tabe_iter].score;
  let ele = ev.parentElement.parentElement;
  ele.children[1].innerText = showword;
  ele.children[2].innerHTML="<button onclick='score(this)'>bad</button><button onclick='score(this)'>good</button>";
  ele.children[3].innerHTML= Math.round((score[0]/score[1])*100)+"% ("+score[0]+"/"+score[1]+")";
  ele.children[4].innerHTML="<button onclick='remove(this)'>Delete</button><button onclick='update(this)' value= '"+id+"'>Update</button>";
}

}




// 3. Update score in db & get new score 
function score(ev){
  const xhttp2 = new XMLHttpRequest();

  xhttp.onload = function() {
  let response = JSON.parse(this.responseText); 
  
  if(ev.innerText == "good"){
    ev.parentElement.parentElement.children[3].innerText=Math.round((response[0]/response[1])*100)+"% ("+response[0]+"/"+response[1]+")";
    ev.parentElement.parentElement.style.backgroundColor = "rgb(0, 128, 0)";
    ev.parentElement.innerHTML="";
  }else if(ev.innerText == "bad"){
    ev.parentElement.parentElement.children[3].innerText= Math.round((response[0]/response[1])*100)+"% ("+response[0]+"/"+response[1]+")";
    ev.parentElement.parentElement.style.backgroundColor = "rgb(255, 102, 102)";
    ev.parentElement.innerHTML="";
  }
}
// Send a request
xhttp.open("GET", "db/score.php?id="+id+"&value="+ev.innerText);
xhttp.send();
}








// 4. Modal box for deleting word
let ele;
document.getElementById("yes_delete").addEventListener("click", remove_yes);
document.getElementById("no_delete").addEventListener("click", remove_no);

//delete
function remove(ev){
  ele=ev.parentElement.parentElement;
  document.getElementById("modal_box").style.display="block";
}

function remove_yes(){
  const xhttp = new XMLHttpRequest();

  xhttp.onload = function(){
  ele.style.display = "none";
  document.getElementById("modal_box").style.display="none";
  }
  xhttp.open("GET", "db/delete.php?id="+id);
  xhttp.send(); 
}

function remove_no(){
  document.getElementById("modal_box").style.display="none";
}


// update words
const modalUpdate = document.getElementById('modal_update');
const closeUpdate = document.getElementById('closeUpdate');
const sendUpdate = document.getElementById('sendUpdate'); 
const updateForm = document.getElementById('updateForm'); 
const updateId = document.getElementById('updateId');

function update(ev) {
  let a = ev.parentNode.parentNode.children[0].children[0].innerText;
  let b = ev.parentNode.parentNode.children[1].innerText;
  console.log(ev.value);
  updateForm.children[1].value = a;
  updateForm.children[3].value = b;
  updateForm.children[4].value = ev.value;

  modalUpdate.style.display= "block";
  sendUpdate.addEventListener('click', ()=>  updateForm.submit() );
}

closeUpdate.addEventListener('click', ()=>{modalUpdate.style.display="none"});




</script>

<script src="js/load_tb.js"></script>
<script src="js/sort.js"></script>
<!-- <script src="js/twist.js"></script> -->
<script src="js/t.js"></script>
<script src="js/stats.js"></script>
<!-- <script src="js/ps.js"></script> -->
<script src="js/tb_screen.js"></script>
<!-- <script src="hoverTranslation.js"></script> -->



</body>
</html>