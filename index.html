<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/main.css">
  <title>Page Title</title>
</head>





<body>

<div id="row1">
  <a href="add_new.html">Add New Word</a>
</div>

<div id="row2">
  <a>Best first</a>
  <a>Worst first</a>
  <a>Random</a>
  <a href="">Newest</a>
  <a href="">Oldest</a>
</div>

<div id="row3">
  row 3
</div>



<div id="modal_box">
  <div id="modal_content">
    Do you want to delete this word ?<br><br>
    <button id="yes_delete"> YES </button><button id="no_delete">NO</button>
  </div>
</div>

<script>
// GET TABLE FROM THE SERVER 

//const tabe_db = new Object();
let tabe_db = [];
let id;
let tabe_iter; // iteration of elements on the page 


// AJAX
const xhttp = new XMLHttpRequest();
console.log(xhttp);
// Recive JSON and convert to object 
xhttp.onload = function() {
  tabe_db = JSON.parse(this.responseText);
// function display table with vocabulary on the webpage.  
let table ="";
for (let x in tabe_db) {
  table = table + "<div class='tb'><div><button value='"+ tabe_db[x].id+"' onclick='display(this)'>"+ tabe_db[x].newword +"</button></div> <div id='te22'>w</div> <div></div><div></div><div></div>" +"</div>";
  document.getElementById("row3").innerHTML=table;
}
}
// Send a request
xhttp.open("GET", "db.php");
xhttp.send();




// disply transletion and ratting button after pressing word  
function display(ev){
id = ev.value;

//      find iteration of object with current id
for(let x in tabe_db){
if(tabe_db[x].id==id){
tabe_iter = x; 
console.log(x);
console.log("id:"+id);
}
}

let showword = tabe_db[tabe_iter].transl;
let ele = ev.parentElement.parentElement;
ele.children[1].innerText = showword;
ele.children[2].innerHTML="<button onclick='score(this)'>bad</button><button onclick='score(this)'>good</button>";
ele.children[4].innerHTML="<button onclick='remove(this)'>Delete</button><button onclick='update(this)'>Update</button>";
}




// get score 
function score(ev){
console.log("hello world");
  const xhttp2 = new XMLHttpRequest();

xhttp.onload = function() {
  let response = JSON.parse(this.responseText); 
  
  if(ev.innerText == "good"){
    console.log(ev.parentElement.parentElement.children[3]);
    ev.parentElement.parentElement.children[3].innerText=response[0]+ "/"+response[1];
    ev.parentElement.parentElement.style.backgroundColor = "rgb(204, 255, 179)";
    ev.parentElement.innerHTML="";
  }else if(ev.innerText == "bad"){
    ev.parentElement.parentElement.children[3].innerText=response[0]+"/"+response[1];
    ev.parentElement.parentElement.style.backgroundColor = "rgb(255, 204, 204)";
    ev.parentElement.innerHTML="";
  }
}
// Send a request
xhttp.open("GET", "score.php?id="+id+"&value="+ev.innerText);
xhttp.send();
}








// Modal box for deleting word
let ele;
document.getElementById("yes_delete").addEventListener("click", remove_yes);
document.getElementById("no_delete").addEventListener("click", remove_no);



//delete
function remove(ev){
  ele=ev.parentElement.parentElement;
  document.getElementById("modal_box").style.display="block";
}

function remove_yes(){
  const xhttp = new XMLHttpRequest();

  xhttp.onload = function(){
  ele.style.display = "none";
  document.getElementById("modal_box").style.display="none";
  }
  xhttp.open("GET", "db/delete.php?id="+id);
  xhttp.send(); 
}

function remove_no(){
  document.getElementById("modal_box").style.display="none";
}

</script>

</body>
</html>